<html>
<head>
    <meta charset="UTF-8">
    <title>Panning</title>

    <style type="text/css">
* {
    margin: 0;
    padding: 0;
}

body {
    background: #eee;
    padding: 20px 0;
}



    </style>

</head>
<body>

    <!-- CANVAS -->
    <div class="container">
        <div class="canvas-container">
            <canvas id="canvas"></canvas>
        </div>
    </div>

    <!-- SCRIPT -->
    <script type="text/javascript">

var canvas = document.getElementById("canvas");
var ctx = canvas.getContext("2d");
var width = canvas.width = window.innerWidth;
var height = canvas.height = window.innerHeight;
var panX = 0, panY = 0;
var scaleBorderFactor = 2; /* scale factor for the bounds */
var mouse = {
    x: 0,
    y: 0
}

function Circle(x, y, radius, color){
    this.x = x;
    this.y = y;
    this.radius = radius;
    this.color = color;
    this.draw = function(ctx){
        ctx.beginPath();
        ctx.arc(this.x,this.y,this.radius,0,Math.PI*2,false);
        ctx.fillStyle = this.color;
        ctx.fill();
        ctx.closePath();
    }
}

var circle = new Circle(200,200,40,'blue');



window.addEventListener('mousemove', function (e) {
  mouse.x = e.x;
  mouse.y = e.y;
});

function lerp(start, end, percent){
  return start*(1 - percent) + percent*end;
}

/* t: current time, b: beginning value, c: change in value, d: duration */
function easeInOutCubic(t, b, c, d) {
    if ((t/=d/2) < 1) return c/2*t*t*t + b;
    return c/2*((t-=2)*t*t + 2) + b;
}

function getDistance(x1, y1, x2, y2) {
    return Math.sqrt((x2 - x1) ** 2 + (y2 - y1) ** 2);
  }


/* widthGap is the new leftSide formula.
*  it is the gap differance between border and canvas
*/
var widthGap = (canvas.width*scaleBorderFactor - canvas.width)/2;
var heightGap = (canvas.height*scaleBorderFactor - canvas.height)/2;

class Imagez {
    constructor(x, y, zoom, imgSrc) {
      this.zoom = zoom;
      this.x = x;
      this.y = y;
      this.img = new Image();
      this.img.src = imgSrc;
      this.targetZoom = zoom;
      this.targetX = x;
      this.targetY = y;
      this.originalZoom = zoom;
      this.originalX = x;
      this.originalY = y;
    }
  
    draw = () => {
      ctx.drawImage(this.img, this.x, this.y, this.img.width * this.zoom, this.img.height * this.zoom);
      this.update();
    };
  
    update = () => {
        
        let xCenter = this.x + this.img.width / 2;
        let yCenter = this.y + this.img.height / 2;
        let distance = getDistance(xCenter, yCenter, mouse.x, mouse.y);
        
        if (distance < this.img.width / 4 || distance < this.img.height / 4) {
          let newZoom = 1 + (this.img.width / 4 - distance) / (this.img.width / 4) * 0.5;
          let newWidth = this.img.width * newZoom;
          let newHeight = this.img.height * newZoom;
          let widthDiff = (newWidth - this.img.width) / 2;
          let heightDiff = (newHeight - this.img.height) / 2;
          this.targetZoom = newZoom;
          this.targetX = this.x - widthDiff;
          this.targetY = this.y - heightDiff;
        } else {
          this.targetZoom = 0.5;
          this.targetX = this.originalX;
          this.targetY = this.originalY;
        }
        
        this.zoom += (this.targetZoom - this.zoom) * 0.05;
        this.x += (this.targetX - this.x) * 0.05;
        this.y += (this.targetY - this.y) * 0.05;
      }
  }


function panUpdate(){
    canvas = document.getElementById("canvas");
    ctx = canvas.getContext("2d");
    width = canvas.width = canvas.clientWidth;
    height = canvas.height = canvas.clientHeight;

    ctx.clearRect(0,0,width,height);
    ctx.save();

    newPercentX = (mouse.x / width);
    newPercentY = (mouse.y / height);

    /* MOUSE */
    percentX = lerp(percentX,newPercentX,0.05);
    percentY = lerp(percentY,newPercentY,0.05);

    panX = (widthGap) * percentX + (-widthGap) * (1 - percentX);
    panY = (heightGap) * percentY + (-heightGap) * (1 - percentY);

    ctx.translate(-panX,-panY);


    imgArray.forEach(image => {
      image.draw();
    });

    ctx.restore();

    requestAnimationFrame(panUpdate);
}


let imgArray = [];
for (let i = 0; i < 20; i++) {
    let zoom = 0.5;
    let x = Math.random() * window.innerWidth;
    let y = Math.random() * window.innerHeight;
    let imgSrc = 'IMG_1566.jpg';
    imgArray.push(new Imagez(x, y, zoom, imgSrc));
  };


function animate() {
    requestAnimationFrame(animate);
    ctx.clearRect(0, 0, window.innerWidth, window.innerHeight);
    imgArray.forEach(image => {
      image.draw();
    });
  };

/* Draw Update */

//animate();

panUpdate();

var newPercentX = 0, newPercentY = 0;
var percentX = 0, percentY = 0;



    </script>
</body>
</html> 